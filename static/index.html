<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>円グラフ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Rust + Chart.js 円グラフ</h1>
    <table border="1" id="assetTable">
        <thead>
            <tr>
                <th>資産区分</th><th>金額</th><th>割合(%)</th><th>目標金額</th><th>目標割合(%)</th>
            </tr>
        </thead>
        <tbody>
            <!-- データ行がここに入る -->
        </tbody>
    </table>
    <script>
        async function fetchFlights() {
            const res = await fetch('/api/view_assets');
            const assets = await res.json();

            const tbody = document.querySelector('#assetTable tbody');
            tbody.innerHTML = ''; // クリア

            assets.forEach(asset => {
              const tr = document.createElement('tr');

              const td1 = document.createElement('td');
              td1.textContent = asset.asset_name;

              const td2 = document.createElement('td');
              td2.textContent = asset.amount;
              td2.style.textAlign = "right"; // 中央揃え

              const td3 = document.createElement('td');
              td3.textContent = asset.ratio;
              td3.style.textAlign = "right"; // 中央揃え

              const td4 = document.createElement('td');
              td4.textContent = asset.target_amount;
              td4.style.textAlign = "right"; // 中央揃え

              const td5 = document.createElement('td');
              td5.textContent = asset.target_ratio;
              td5.style.textAlign = "right"; // 中央揃え

              tr.appendChild(td1);
              tr.appendChild(td2);
              tr.appendChild(td3);
              tr.appendChild(td4);
              tr.appendChild(td5);

              tbody.appendChild(tr);
            });
        }

        // ページ読み込み時に呼び出す
        window.onload = fetchFlights;
    </script>

    <canvas id="myChart" width="400" height="400"></canvas>
    <script type="module">
        import init from './pkg/your_wasm_project.js';
        init().then(() => {
            const ctx = document.getElementById('myChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['A', 'B', 'C'],
                    datasets: [{
                        label: 'データセット',
                        data: [10, 20, 30],
                        backgroundColor: ['red', 'blue', 'green']
                    }]
                }
            });
        });
    </script>
    <div id="drop-area" style="border: 1px; border-top: 1px; border-color: black;">ここにファイルをドロップ</div>
    <script>
        const dropArea = document.getElementById("drop-area");

        dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.style.backgroundColor = 'green';
        });

        dropArea.addEventListener("dragleave", () => {
        dropArea.style.backgroundColor = 'white';
        });

        dropArea.addEventListener("drop", (e) => {
            e.preventDefault();
            dropArea.style.borderColor = "#ccc";

            const files = e.dataTransfer.files;
            const formData = new FormData();
            formData.append("file", files[0]);
            dropArea.style.backgroundColor = 'white';

            fetch("/upload", {
                method: "POST",
                body: formData,
            }).then(response => {
                if (!response.ok) {
                    throw new Error("アップロード失敗")
                }
                return response.text();
            })
            .then(text => {
                console.log("サーバーからの応答:", text);
                alert("サーバー応答: " + text);
            })
            .catch(err => {
                console.error("エラー:", err);
                alert("エラー: " + err.message);
            });
        });
    </script>    
  
</body>
</html>
